name: Regression Tests
on:
  pull_request:
    types: [ opened, reopened, synchronize ]
  workflow_dispatch:

jobs:
  Tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11
        with:
          fetch-depth: 0  # This causes all history to be fetched, which is required for calculate-version to function
      - name: build
        uses: ./.github/workflows/build.yml
        with:
          provision_status: "Success"
      - name: Regression Tests
        run: |
          export BASE_URL=Https://internal-qa.api.service.nhs.uk/electronic-prescriptions/
          echo API base url = $BASE_URL
          source .venv/bin/activate && python runner.py
